workflows:
  dexscreener_safari_web:
    name: Dexscreener Safari Web Extension
    max_build_duration: 30
    instance_type: mac_mini_m2
    environment:
      vars:
        APP_NAME: "DexscreenerTrader"
        BUNDLE_ID: "com.millitradez.dexscreenertrader"
        CM_API_TOKEN: "test"
      xcode: latest
    triggering:
      events:
        - push
      branch_patterns:
        - pattern: main
          include: true
          source: true
    scripts:
      - name: 🔧 Prepare Safari Extension package
        script: |
          echo "Preparing Dexscreener Safari Web Extension..."
          mkdir -p build/safari
          cp -r content icons popup background.js manifest.json build/safari/ 2>/dev/null || true
          echo "✅ Copied extension files."

      - name: 📦 Package extension
        script: |
          echo "Zipping extension for Safari..."
          cd build/safari
          zip -r "../${APP_NAME}_SafariExtension.zip" .

    artifacts:
      - build/${APP_NAME}_SafariExtension.zip

    publishing:
      scripts:
        - name: 🌐 Generate artifact link
          script: |
            echo "✅ Safari Web Extension packaged successfully."
            echo "You can now download and sign it with Xcode → File → New → Project → Safari Extension."
