workflows:
  safari_extension_ios_free:
    name: Safari Extension (iOS Mobile)
    max_build_duration: 60
    instance_type: mac_mini_m2

    environment:
      xcode: 16.4
      vars:
        APP_NAME: "DexscreenerTraderExtension"
        BUNDLE_ID: "com.tradezconsulting.dexscreenertrader"
        APPLE_ID_EMAIL: "Tradezconsulting@icloud.com"

    scripts:
      - name: ðŸ§¹ Clean workspace
        script: |
          rm -rf build || true
          mkdir -p build

      - name: ðŸ§© Verify and convert Chrome extension
        script: |
          echo "Verifying Chrome extension files..."
          ls -R
          echo "âœ… Chrome extension verified"

      - name: ðŸš€ Build Safari extension (iOS mobile)
        script: |
          echo "Building Safari iOS extension..."
          cd DexscreenerTraderExtension
          xcodebuild \
            -project DexscreenerTraderExtension.xcodeproj \
            -scheme "DexscreenerTraderExtension (iOS)" \
            -configuration Release \
            CODE_SIGNING_ALLOWED=NO \
            build

      - name: ðŸ“¦ Package iOS app for AltStore / EonHub
        script: |
          echo "Creating unsigned IPA..."
          mkdir -p build/ipa
          xcrun xcodebuild -exportArchive \
            -archivePath build/${APP_NAME}.xcarchive \
            -exportPath build/ipa \
            -exportOptionsPlist <(echo '<?xml version="1.0" encoding="UTF-8"?><plist version="1.0"><dict><key>method</key><string>ad-hoc</string></dict></plist>') || true
          echo "âœ… Unsigned IPA ready for AltStore / EonHub"

    artifacts:
      - build/ipa/**

    publishing:
      email:
        recipients:
          - Tradezconsulting@icloud.com
        notify:
          success: true
          failure: true
